#ifndef NETWORKRPC_H
#define NETWORKRPC_H

#include "datagram.h"
#include "datagramIterator.h"

class NetworkClass;

// Defines a message sent in the context of a particular networked object.
struct NetworkRPC {

  typedef void (*RecvFunc)(void *object, void *data);

  // Flags defining behavior of RPC.
  enum Flags {
    F_none = 0,
    F_clsend = 1 << 0, // RPC may be sent by a client that doesn't own the object to the AI.
    F_airecv = 1 << 1, // Not used.
    F_ownsend = 1 << 2, // RPC may be sent by the client that owns the object to the AI.
    F_broadcast = 1 << 3, // RPC is sent to all clients that have network visibility on the object.
  };

  std::string name = "";
  unsigned int flags = F_none;
  // Network class containing serialized fields for the RPC.
  // This will also correspond to a structure in the C++ code.
  NetworkClass *net_class = nullptr;

  // Callback when RPC is received on an object.  The deserialized structure
  // is passed into void *data.
  RecvFunc recv = nullptr;

  void write(Datagram &dg, void *object);
  void read(DatagramIterator &scan, void *object);

  void output(std::ostream &out, int indent_level = 0) const;
};

#endif // NETWORKRPC_H
